##############################################################################
# GlucoFarmer Dashboard v1.3.0 (statische Referenz)
#
# HINWEIS: Das Dashboard wird automatisch von dashboard.py generiert.
# Diese Datei dient nur als Referenz fuer manuelles Setup.
#
# Anleitung:
#   1. In HA: Einstellungen > Dashboards > Dashboard hinzufuegen
#   2. Name: "GlucoFarmer", Icon: mdi:diabetes
#   3. Dashboard oeffnen > Drei-Punkte-Menue > Raw-Konfigurationseditor
#   4. Diesen Inhalt einfuegen
#   5. Fuer jedes Profil die ENTITY-IDs anpassen (suche nach "subject_01")
#
# Voraussetzungen:
#   - apexcharts-card (HACS custom card) fuer Glucose-Verlauf
#
# Fuer weitere Profile: Abschnitte duplizieren und IDs anpassen.
##############################################################################

views:
  ##########################################################################
  # SEITE 1: UEBERSICHT
  ##########################################################################
  - title: Uebersicht
    path: overview
    icon: mdi:view-dashboard
    badges: []
    cards:
      - type: markdown
        content: "# GlucoFarmer"

      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Subject-01"

          - type: horizontal-stack
            cards:
              - type: conditional
                conditions:
                  - condition: state
                    entity: sensor.subject_01_glucose_value
                    state_not: unavailable
                  - condition: state
                    entity: sensor.subject_01_glucose_value
                    state_not: unknown
                card:
                  type: gauge
                  entity: sensor.subject_01_glucose_value
                  name: Glucose
                  unit: mg/dL
                  min: 20
                  max: 350
                  needle: true
                  segments:
                    - from: 0
                      color: red
                      label: Kritisch
                    - from: 55
                      color: orange
                      label: Niedrig
                    - from: 70
                      color: green
                      label: Normal
                    - from: 180
                      color: orange
                      label: Hoch
                    - from: 250
                      color: red
                      label: Sehr hoch

              - type: entities
                entities:
                  - entity: sensor.subject_01_glucose_value
                    name: Glucose
                  - entity: sensor.subject_01_glucose_trend
                    name: Trend
                  - entity: sensor.subject_01_reading_age
                    name: Sync

          - type: history-graph
            entities:
              - entity: sensor.subject_01_glucose_value
                name: Subject-01
            hours_to_show: 6
            logarithmic_scale: false

  ##########################################################################
  # SEITE 2: EINGABE
  ##########################################################################
  - title: Eingabe
    path: input
    icon: mdi:pencil-plus
    badges: []
    cards:
      - type: markdown
        content: "# Eingabe"

      - type: markdown
        content: >
          ## Subject-01 - Aktuell

          {% set val = states('sensor.subject_01_glucose_value') %}
          {% set status = states('sensor.subject_01_glucose_status') %}
          {% set trend = states('sensor.subject_01_glucose_trend') %}
          {% if status in ['critical_low', 'very_high'] %}
          **! Glucose: {{ val }} mg/dL !**
          {% elif status in ['low', 'high'] %}
          **Glucose: {{ val }} mg/dL**
          {% else %}
          Glucose: {{ val }} mg/dL
          {% endif %}
          | Trend: {{ trend }}
          | Insulin heute: {{ states('sensor.subject_01_daily_insulin_total') }} IU
          | BE heute: {{ states('sensor.subject_01_daily_bes_total') }} BE

      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Fuetterung loggen"
          - type: entities
            entities:
              - entity: number.subject_01_feeding_amount
                name: Menge (BE)
              - entity: select.subject_01_feeding_category
                name: Kategorie
              - entity: text.subject_01_event_timestamp
                name: Zeitstempel (leer = jetzt)
          - type: button
            entity: button.subject_01_log_feeding
            name: Fuetterung loggen
            icon: mdi:food-apple-outline
            tap_action:
              action: toggle
            show_state: false

      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Insulin loggen"
          - type: entities
            entities:
              - entity: number.subject_01_insulin_amount
                name: Menge (IU)
              - entity: select.subject_01_insulin_product
                name: Produkt
              - entity: text.subject_01_event_timestamp
                name: Zeitstempel (leer = jetzt)
          - type: button
            entity: button.subject_01_log_insulin
            name: Insulin loggen
            icon: mdi:needle
            tap_action:
              action: toggle
            show_state: false

      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              ## Letzte Eintraege

              {% set events = state_attr('sensor.subject_01_today_events', 'events') or [] %}
              {% if events | length > 0 %}
              | Zeit | Typ | Menge | ID |
              |------|-----|-------|-----|
              {% for e in events %}
              | {{ e.timestamp[11:16] if e.timestamp | length > 16 else e.timestamp }} | {{ e.type }} | {{ e.amount }} {{ 'IU' if e.type == 'insulin' else 'BE' }} | `{{ e.id[:8] }}` |
              {% endfor %}
              {% else %}
              Keine Eintraege heute.
              {% endif %}
          - type: entities
            entities:
              - entity: text.subject_01_archive_event_id
                name: Event-ID zum Archivieren
          - type: button
            entity: button.subject_01_archive_event
            name: Event archivieren
            icon: mdi:archive-arrow-down
            tap_action:
              action: toggle
            show_state: false

  ##########################################################################
  # SEITE 3: STATISTIKEN
  ##########################################################################
  - title: Statistiken
    path: stats
    icon: mdi:chart-bar
    badges: []
    cards:
      - type: markdown
        content: "# Statistiken"

      - type: entities
        entities:
          - entity: select.subject_01_chart_timerange
            name: Zeitraum

      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Subject-01"

          - type: horizontal-stack
            cards:
              - type: markdown
                content: >
                  ### Zonen-Verteilung

                  ðŸ”´ {{ states('sensor.subject_01_time_very_high_pct') }}% Sehr hoch

                  ðŸŸ  {{ states('sensor.subject_01_time_high_pct') }}% Hoch

                  ðŸŸ¢ {{ states('sensor.subject_01_time_in_range_pct') }}% Zielbereich

                  ðŸŸ¡ {{ states('sensor.subject_01_time_low_pct') }}% Niedrig

                  ðŸ”´ {{ states('sensor.subject_01_time_critical_low_pct') }}% Sehr niedrig

              - type: entities
                title: Details
                entities:
                  - entity: sensor.subject_01_data_completeness_today
                    name: Datenvollstaendigkeit
                  - entity: sensor.subject_01_daily_insulin_total
                    name: Insulin gesamt
                  - entity: sensor.subject_01_daily_bes_total
                    name: Fuetterung gesamt

          - type: custom:apexcharts-card
            header:
              show: true
              title: Glucose-Verlauf
            graph_span: 24h
            apex_config:
              chart:
                toolbar:
                  show: true
                  tools:
                    download: true
                    selection: true
                    zoom: true
                    zoomin: true
                    zoomout: true
                    pan: true
                    reset: true
              yaxis:
                - min: 20
                  max: 350
                  title:
                    text: mg/dL
              annotations:
                yaxis:
                  - y: 55
                    borderColor: "#FF0000"
                    label:
                      text: Kritisch
                  - y: 70
                    borderColor: "#FFA500"
                    label:
                      text: Niedrig
                  - y: 180
                    borderColor: "#FFA500"
                    label:
                      text: Hoch
                  - y: 250
                    borderColor: "#FF0000"
                    label:
                      text: Sehr hoch
            series:
              - entity: sensor.subject_01_glucose_value
                name: Glucose
                type: line
                color: "#2196F3"
                stroke_width: 2

  ##########################################################################
  # SEITE 4: EINSTELLUNGEN
  ##########################################################################
  - title: Einstellungen
    path: settings
    icon: mdi:cog
    badges: []
    cards:
      - type: markdown
        content: "# Einstellungen"

      - type: entities
        title: "Subject-01 - Schwellwerte"
        show_header_toggle: false
        entities:
          - entity: number.subject_01_critical_low_threshold
            name: Kritisch niedrig (mg/dL)
          - entity: number.subject_01_low_threshold
            name: Untere Grenze (mg/dL)
          - entity: number.subject_01_high_threshold
            name: Obere Grenze (mg/dL)
          - entity: number.subject_01_very_high_threshold
            name: Sehr hoch (mg/dL)
          - entity: number.subject_01_data_timeout
            name: Daten-Timeout (Minuten)

      - type: markdown
        content: >
          ## Kataloge und Presets verwalten

          Insulin-Produkte, Fuetterungskategorien und Presets werden ueber
          den **Options Flow** der Integration verwaltet:

          **Einstellungen > Geraete & Dienste > GlucoFarmer > Konfigurieren**

          Dort kannst du:

          - Insulin-Produkte hinzufuegen/entfernen

          - Fuetterungskategorien hinzufuegen/entfernen

          - Presets erstellen/loeschen (erscheinen als Buttons auf der Eingabe-Seite)
